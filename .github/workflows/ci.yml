name: MLOps Training Pipeline

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  run-training:
    runs-on: ubuntu-latest
    
    steps:
    # 1. è·å–ä»£ç 
    - name: Checkout code
      uses: actions/checkout@v3
      
    # 2. è®¾ç½®Pythonç¯å¢ƒ
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    # 3. å®‰è£…ä¾èµ–
    - name: Install dependencies
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
        
    # 4. éªŒè¯ç¯å¢ƒ
    - name: Verify imports
      run: |
        python -c "import sklearn; import mlflow; print('âœ… æ‰€æœ‰åº“å°±ç»ª')"
        
    # 5. è¿è¡Œä½ çš„è®­ç»ƒè„šæœ¬ï¼ğŸ¯
    - name: Execute ML Training
      run: |
        cd src
        python train.py --experiment-name "auto_run_${{ github.run_number }}"
        
    # 6. (å¯é€‰) ä¸Šä¼ MLflowäº§ç‰©ä½œä¸ºå·¥ä½œæµé™„ä»¶
    - name: Archive MLflow artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: mlflow-run
        path: mlruns/ # MLflowé»˜è®¤çš„æœ¬åœ°è®°å½•ç›®å½•
        retention-days: 7
